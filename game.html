<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Angry Bird Jumper</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: linear-gradient(to top, #222, #000);
      font-family: sans-serif;
    }
    #startScreen, #endingScreen {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.9);
      color: white;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 10;
    }
    #startScreen h1, #endingScreen h1 {
      font-size: 48px;
      margin-bottom: 20px;
    }
    #startScreen button {
      padding: 15px 30px;
      font-size: 20px;
      background: crimson;
      color: white;
      border: none;
      cursor: pointer;
      border-radius: 10px;
    }
    canvas {
      display: none;
      margin: auto;
      background: #333;
      border: 2px solid crimson;
    }
    #info {
      position: absolute;
      top: 10px;
      left: 10px;
      color: white;
      font-size: 18px;
      display: none;
    }
  </style>
</head>
<body>

<div id="startScreen">
  <h1>üê¶ Angry Bird Jumper</h1>
  <p>Kumpulkan koin, hindari rintangan, dan tamatkan game!</p>
  <button onclick="startGame()">Mulai Game</button>
</div>

<div id="endingScreen" style="display:none;">
  <h1>üéâ Tamat!</h1>
  <p>Kamu berhasil menyelesaikan semua level!</p>
  <button onclick="restartGame()">Main Lagi</button>
</div>

<canvas id="game" width="900" height="500"></canvas>
<div id="info">Level: 1 | Skor: 0</div>

<audio id="jumpSound" src="https://www.soundjay.com/button/sounds/button-16.mp3" preload="auto"></audio>
<audio id="winSound" src="https://www.soundjay.com/human/sounds/applause-8.mp3" preload="auto"></audio>

<script>
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const jumpSound = document.getElementById('jumpSound');
  const winSound = document.getElementById('winSound');
  const info = document.getElementById('info');
  const startScreen = document.getElementById('startScreen');
  const endingScreen = document.getElementById('endingScreen');

  let keys = {};
  let level = 1;
  let score = 0;
  let gameStarted = false;
  const gravity = 0.5;

  const birdImg = new Image();
  birdImg.src = 'https://i.imgur.com/1XqZ1Zr.png';

  const player = {
    x: 50, y: 400, width: 40, height: 40,
    dx: 0, dy: 0,
    onGround: false
  };

  let platforms = [];
  let coins = [];

  function startGame() {
    startScreen.style.display = 'none';
    canvas.style.display = 'block';
    info.style.display = 'block';
    gameStarted = true;
    level = 1;
    score = 0;
    resetPlayer();
    generateLevel(level);
    loop();
  }

  function restartGame() {
    endingScreen.style.display = 'none';
    startGame();
  }

  function resetPlayer() {
    player.x = 50;
    player.y = 400;
    player.dy = 0;
  }

  function generateLevel(lvl) {
    platforms = [{ x: 0, y: 460, width: 900, height: 40 }];
    coins = [];

    let count = 3 + lvl;
    for (let i = 0; i < count; i++) {
      let px = 150 + i * (100 - lvl * 2);
      let py = 400 - i * (20 + lvl * 2);
      platforms.push({ x: px, y: py, width: 100, height: 20 });
      coins.push({ x: px + 40, y: py - 20, width: 20, height: 20, collected: false });
    }

    canvas.style.background = `hsl(${lvl * 36}, 50%, 30%)`;
  }

  function drawRect(obj, color) {
    ctx.fillStyle = color || '#888';
    ctx.fillRect(obj.x, obj.y, obj.width, obj.height);
  }

  function drawCoin(coin) {
    if (!coin.collected) {
      ctx.beginPath();
      ctx.arc(coin.x + 10, coin.y + 10, 10, 0, Math.PI * 2);
      ctx.fillStyle = 'gold';
      ctx.fill();
    }
  }

  function drawPlayer() {
    ctx.drawImage(birdImg, player.x, player.y, player.width, player.height);
  }

  function update() {
    player.dx = 0;
    if (keys['ArrowLeft']) player.dx = -4;
    if (keys['ArrowRight']) player.dx = 4;
    if (keys['w'] && player.onGround) {
      player.dy = -10;
      player.onGround = false;
      jumpSound.play();
    }

    player.dy += gravity;
    player.x += player.dx;
    player.y += player.dy;

    player.onGround = false;
    for (let p of platforms) {
      if (
        player.x < p.x + p.width &&
        player.x + player.width > p.x &&
        player.y + player.height < p.y + p.height &&
        player.y + player.height + player.dy >= p.y
      ) {
        player.dy = 0;
        player.y = p.y - player.height;
        player.onGround = true;
      }
    }

    for (let c of coins) {
      if (
        !c.collected &&
        player.x < c.x + c.width &&
        player.x + player.width > c.x &&
        player.y < c.y + c.height &&
        player.y + player.height > c.y
      ) {
        c.collected = true;
        score += 10;
        info.textContent = `Level: ${level} | Skor: ${score}`;
      }
    }

    if (coins.every(c => c.collected)) {
      winSound.play();
      level++;
      if (level > 5) {
        canvas.style.display = 'none';
        info.style.display = 'none';
        endingScreen.style.display = 'flex';
        gameStarted = false;
        return;
      }
      resetPlayer();
      generateLevel(level);
      info.textContent = `Level: ${level} | Skor: ${score}`;
    }

    if (player.y > canvas.height) {
      alert('Kamu jatuh! Game dimulai dari awal.');
      startScreen.style.display = 'flex';
      canvas.style.display = 'none';
      info.style.display = 'none';
      gameStarted = false;
    }
  }

  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drawPlayer();
    for (let p of platforms) drawRect(p);
    for (let c of coins) drawCoin(c);
  }

  function loop() {
    if (!gameStarted) return;
    update();
    draw();
    requestAnimationFrame(loop);
  }

  document.addEventListener('keydown', e => keys[e.key] = true);
  document.addEventListener('keyup', e => keys[e.key] = false);
</script>
</body>
</html>
